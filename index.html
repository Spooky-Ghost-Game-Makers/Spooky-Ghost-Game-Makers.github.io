<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Spooky Ghost Game (PyScript) - loader</title>

  <style>
    body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; padding: 1rem; }
    #output { white-space: pre-wrap; border: 1px solid #ddd; padding: 1rem; margin-top: 1rem; max-height: 60vh; overflow: auto; background:#fafafa;}
    #status { margin: .5rem 0; color: #b33; }
    .ok { color: #080; }
    .warn { color: #b60; }
  </style>

  <script>
    // Sequential loader for PyScript (tries several CDN sources)
    (function () {
      const cssCandidates = [
        "https://cdn.jsdelivr.net/gh/pyscript/pyscript@latest/dist/pyscript.css",
        "https://unpkg.com/pyscript@latest/dist/pyscript.css"
      ];
      const jsCandidates = [
        "https://cdn.jsdelivr.net/gh/pyscript/pyscript@latest/dist/pyscript.js",
        "https://unpkg.com/pyscript@latest/dist/pyscript.js",
        "https://pyscript.net/latest/pyscript.js"
      ];

      function loadCss(url) {
        return new Promise((resolve, reject) => {
          const link = document.createElement("link");
          link.rel = "stylesheet";
          link.href = url;
          link.onload = () => resolve(url);
          link.onerror = () => reject(url);
          document.head.appendChild(link);
        });
      }

      function loadJs(url) {
        return new Promise((resolve, reject) => {
          const s = document.createElement("script");
          s.src = url;
          s.defer = true;
          s.onload = () => resolve(url);
          s.onerror = () => reject(url);
          document.head.appendChild(s);
        });
      }

      // Try each candidate in order for CSS then JS
      async function tryLoad() {
        const statusElem = document.createElement("div");
        statusElem.id = "status";
        statusElem.innerText = "Trying to load PyScript runtime from CDNs...";
        document.addEventListener("DOMContentLoaded", () => {
          document.body.insertBefore(statusElem, document.body.firstChild);
        });

        let cssLoaded = false;
        for (const cssUrl of cssCandidates) {
          try {
            await loadCss(cssUrl);
            cssLoaded = true;
            console.info("Loaded PyScript CSS from", cssUrl);
            break;
          } catch (e) {
            console.warn("CSS failed:", cssUrl);
          }
        }

        let jsLoaded = false;
        for (const jsUrl of jsCandidates) {
          try {
            await loadJs(jsUrl);
            jsLoaded = true;
            statusElem.innerHTML = "PyScript loaded from: <span class='ok'>" + jsUrl + "</span>. Initialising...";
            console.info("Loaded PyScript JS from", jsUrl);
            break;
          } catch (e) {
            console.warn("JS failed:", jsUrl);
          }
        }

        if (!jsLoaded) {
          statusElem.innerHTML =
            "<strong>Unable to load PyScript from CDNs (404/blocked).</strong><br>" +
            "Try opening the CDN URLs directly in a new tab to confirm access. " +
            "If your network blocks external CDNs you can host the PyScript files in your repository and reference them locally. " +
            "<br><br>Suggested direct test URLs:<br>" +
            cssCandidates.concat(jsCandidates).map(u => `<code>${u}</code>`).join("<br>") +
            "<br><br>If you want, I can: (A) create a commit that includes PyScript assets in your repo, or (B) provide exact curl commands to download the files yourself.";
          statusElem.classList.add("warn");
        } else {
          // If PyScript loads it will automatically process <py-config> and <py-script>
          statusElem.classList.add("ok");
        }
      }

      tryLoad();
    })();
  </script>
</head>
<body>

<h1>Spooky Ghost Game</h1>
<div id="status">Loading PyScript runtime (this page will update)...</div>

<div id="output"></div>

<py-config>
packages = []
</py-config>

<!-- your py-script content goes here (same as before) -->
<py-script>
# Minimal smoke-test print — replace with your full game block if you copied it in
from js import window, document
document.getElementById("output").innerText += "PyScript runtime loaded — executing game code...\n"
# (Place your revised game code here or keep it in this file — once PyScript is loaded it will run.)
</py-script>

</body>
</html>
