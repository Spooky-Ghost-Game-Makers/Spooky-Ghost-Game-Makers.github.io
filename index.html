<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Spooky Ghost Game (PyScript) - loader</title>

  <style>
    body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; padding: 1rem; }
    #output { white-space: pre-wrap; border: 1px solid #ddd; padding: 1rem; margin-top: 1rem; max-height: 60vh; overflow: auto; background:#fafafa;}
    #status { margin: .5rem 0; color: #b33; }
    .ok { color: #080; }
    .warn { color: #b60; }
    #start-btn { font-size: 1.2rem; padding: 0.5rem 1.5rem; margin: 1rem 0; cursor: pointer; }
    #start-btn:disabled { opacity: 0.5; cursor: not-allowed; }
  </style>

  <!-- Load local PyScript CSS -->
  <link rel="stylesheet" href="./assets/pyscript/core.css" />

  <!-- Load local PyScript as ES module -->
  <script type="module" src="./assets/pyscript/core.js"></script>

  <script>
    /**
     * Simple PyScript Loader Status
     * 
     * This loader displays status information about PyScript loading.
     * PyScript is loaded from local vendored files (./assets/pyscript/core.js)
     * as an ES module to avoid "Unexpected token 'export'" errors.
     */
    (function () {
      const localCorePath = "./assets/pyscript/core.js";
      const localCssPath = "./assets/pyscript/core.css";

      /**
       * Check if a URL exists via fetch (HTTP 200)
       */
      async function urlExists(url) {
        try {
          const response = await fetch(url, { method: "HEAD" });
          return response.ok;
        } catch (e) {
          return false;
        }
      }

      async function checkStatus() {
        const statusElem = document.getElementById("status");
        if (!statusElem) return;

        const coreExists = await urlExists(localCorePath);
        const cssExists = await urlExists(localCssPath);

        if (coreExists && cssExists) {
          statusElem.innerHTML = "PyScript loaded from: <span class='ok'>" + localCorePath + "</span> (ES module). Initializing...";
          statusElem.classList.add("ok");
          console.info("PyScript files found:", localCorePath, localCssPath);
        } else if (coreExists) {
          statusElem.innerHTML = "PyScript JS loaded from: <span class='ok'>" + localCorePath + "</span> (CSS missing).";
          statusElem.classList.add("warn");
          console.warn("PyScript CSS not found:", localCssPath);
        } else {
          statusElem.innerHTML =
            "<strong>Unable to load PyScript.</strong><br>" +
            "Expected local file: <code>" + localCorePath + "</code> (not found)<br><br>" +
            "Run <code>./vendor_pyscript.sh</code> to download PyScript files, then reload.";
          statusElem.classList.add("warn");
          console.error("PyScript core.js not found at", localCorePath);
        }
      }

      document.addEventListener("DOMContentLoaded", checkStatus);
    })();
  </script>
</head>
<body>

<h1>Spooky Ghost Game</h1>
<div id="status">Loading PyScript runtime (this page will update)...</div>

<button id="start-btn" disabled>Start Game</button>

<div id="output"></div>

<py-config>
packages = []
</py-config>

<!-- PyScript game content -->
<py-script>
from js import window, document

def log(msg):
    """Append a message to the output div."""
    output = document.getElementById("output")
    output.innerText += msg + "\n"

def start_game():
    """Main game entry point - called when Start Game button is clicked."""
    log("=== Spooky Ghost Game Started ===")
    log("Welcome, brave soul!")
    log("")
    log("You find yourself in a haunted mansion...")
    log("The door creaks shut behind you.")
    log("")
    log("(Game prompts will appear here)")
    log("(Replace this with your full game logic)")

# Initialize page
log("PyScript runtime loaded â€” ready to play!")

# Enable the start button and wire up the click handler
start_btn = document.getElementById("start-btn")
start_btn.disabled = False
start_btn.onclick = lambda e: start_game()

log("Click 'Start Game' to begin.")
</py-script>

</body>
</html>
